{"version":3,"sources":["webpack:///./js/src/components/PrivateRoute.jsx","webpack:///./js/src/components/SPA.jsx","webpack:///./js/src/utils/Token.jsx","webpack:///./js/src/utils/UserContext.jsx"],"names":["PrivateRoute","Component","component","rest","useContext","UserContext","user","props","parseInt","uID","pathname","state","from","location","propTypes","PropTypes","func","string","Index","LoadableLogin","Loadable","loader","loading","Loading","LoadableMe","SPAInner","setUser","refreshTokenFetch","fetch","configMap","secureProtocol","refreshTokenUrl","method","credentials","headers","logoutFetch","logoutUrl","authorization","localStorage","getItem","globalNames","authToken","refreshToken","response","json","answer","getUser","error","setItem","MakeError","document","reload","window","request","operation","isTokenExpired","setContext","Authorization","cache","InMemoryCache","client","ApolloClient","link","ApolloLink","RetryLink","delay","initial","max","Infinity","jitter","attempts","retryIf","log","onError","graphQLErrors","networkError","hasTokenInvalid","forEach","debugMessage","Observable","observer","message","next","forward","handle","Promise","resolve","then","subscribe","bind","complete","unsubscribe","HttpLink","uri","graphqlUrl","writeData","data","isLoggedIn","SPA","token","jwtDecode","exp","Math","round","Date","getTime","React","createContext","UserProvider","useState","anonymusToken","children","object"],"mappings":"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","file":"1.concrete5_graphql_websocket_security_sample.js","sourcesContent":["import React, { useContext } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Route, Redirect } from \"react-router-dom\";\n\nimport {UserContext} from 'Utils/UserContext';\n// eslint-disable-next-line no-unused-vars\nimport log from \"Log\";\nimport { getUser } from \"../utils/Token\";\n\nfunction PrivateRoute({ component: Component, ...rest }) {\n    const [user] = useContext(UserContext);\n    return (\n        <Route\n            {...rest}\n            render={props =>\n                user && parseInt(user.uID) > 0 ? (\n                    <Component {...props} />\n                ) : (\n                    <Redirect\n                        to={{\n                            pathname: \"/login\",\n                            state: { from: props.location }\n                        }}\n                    />\n                )\n            }\n        />\n    );\n}\n\nPrivateRoute.propTypes = {\n    component: PropTypes.func,\n    location: PropTypes.string\n};\n\nexport default PrivateRoute;\n","import React, { useState, useContext } from \"react\";\nimport { HashRouter as Router, Route, Link } from \"react-router-dom\";\nimport fetch from \"unfetch\";\n\nimport ApolloClient from \"apollo-client\";\nimport { HttpLink } from \"apollo-link-http\";\n\nimport { ApolloProvider } from \"react-apollo\";\nimport { ApolloProvider as ApolloHooksProvider } from \"@apollo/react-hooks\";\nimport { ApolloLink, Observable } from \"apollo-link\";\nimport { RetryLink } from \"apollo-link-retry\";\nimport { onError } from \"apollo-link-error\";\nimport { InMemoryCache } from \"apollo-cache-inmemory\";\n\nimport Loadable from \"react-loadable\";\nimport Loading from \"./Loading\";\n\nimport PrivateRoute from \"./PrivateRoute\";\n\nimport configMap from \"Utils/GetGlobals\";\nimport { getUser, isTokenExpired } from \"Utils/Token\";\nimport MakeError from \"Utils/MakeError\";\nimport { UserContext, UserProvider } from \"Utils/UserContext\";\nimport { globalNames } from \"Utils/GetGlobals\";\n// eslint-disable-next-line no-unused-vars\nimport log from \"Log\";\n\nfunction Index() {\n    return (\n        <div>\n            <br />\n            <br />\n            <br />\n            <br />\n            <br />\n            <br />\n            <br />\n            <br />\n            <br />\n            <br />\n            <br />\n            <br />\n            <h2>Home</h2>\n            <Link to=\"/me\">Me</Link>\n        </div>\n    );\n}\n\nconst LoadableLogin = Loadable({\n    loader: () => import(\"../single_pages/Login\"),\n    loading: Loading\n});\n\nconst LoadableMe = Loadable({\n    loader: () => import(\"../single_pages/Me\"),\n    loading: Loading\n});\n\nfunction SPAInner() {\n    const [user, setUser] = useContext(UserContext);\n\n    const refreshTokenFetch = () =>\n        fetch(\n            (configMap.secureProtocol ? \"https://\" : \"http://\") +\n                configMap.refreshTokenUrl,\n            {\n                method: \"POST\",\n                credentials: \"include\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                }\n            }\n        );\n\n    const logoutFetch = () =>\n        fetch(\n            (configMap.secureProtocol ? \"https://\" : \"http://\") +\n                configMap.logoutUrl,\n            {\n                method: \"POST\",\n                credentials: \"include\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    authorization: `Bearer ${localStorage.getItem(\n                        globalNames.authToken\n                    )}`\n                }\n            }\n        );\n\n    const refreshToken = async function() {\n        try {\n            const response = await refreshTokenFetch();\n            const answer = await response.json();\n\n            if (!answer.authToken && getUser() !== false) {\n                const response = await logoutFetch();\n                const answer = await response.json();\n\n                if (!answer.error || answer.error !== \"\") {\n                    localStorage.setItem(\n                        globalNames.authToken,\n                        answer.authToken\n                    );\n                    if(!user || user.uID !== getUser().uID) {\n                        setUser(getUser());\n                    }\n                }\n            } else {\n                localStorage.setItem(globalNames.authToken, answer.authToken);\n                if(!user || user.uID !== getUser().uID) {\n                    setUser(getUser());\n                }\n            }\n        } catch (error) {\n            // full control over handling token fetch Error\n            MakeError(\"Your refresh token is invalid. Try to relogin\", error);\n\n            // your custom action here\n            setUser({});\n            localStorage.setItem(globalNames.authToken, {});\n\n            document.location.reload(true);\n            window.location = \"/\";\n        }\n    };\n\n    const request = async operation => {\n        if (isTokenExpired()) {\n            await refreshToken();\n        }\n        operation.setContext({\n            headers: {\n                Authorization:\n                    \"Bearer \" + localStorage.getItem(globalNames.authToken)\n            }\n        });\n    };\n\n    const cache = new InMemoryCache(); //.restore(window.__APOLLO_STATE__);\n\n    const client = new ApolloClient({\n        link: ApolloLink.from([\n            new RetryLink({\n                delay: {\n                    initial: 300,\n                    max: Infinity,\n                    jitter: true\n                },\n                attempts: {\n                    max: 5,\n                    retryIf: error => log(\"retry\") && !!error\n                }\n            }),\n            onError(({ graphQLErrors, networkError, response }) => {\n                let hasTokenInvalid = true;\n                if (graphQLErrors) {\n                    graphQLErrors.forEach(async error => {\n                        hasTokenInvalid &= !error.debugMessage;\n                        log(hasTokenInvalid);\n                    });\n                }\n\n                if (hasTokenInvalid) {\n                    return new Observable(async observer => {\n                        if (graphQLErrors) {\n                            graphQLErrors.forEach(async message => {\n                                log(`[GraphQL error]: Message: ${message}`);\n                                await refreshToken();\n                            });\n\n                            return observer.next(response);\n                        }\n                        if (networkError) {\n                            log(`[Network error]: ${networkError}`);\n                            log(networkError);\n                        }\n                    });\n                }\n            }),\n            new ApolloLink(\n                (operation, forward) =>\n                    new Observable(observer => {\n                        let handle;\n                        Promise.resolve(operation)\n                            .then(operation => request(operation))\n                            .then(() => {\n                                handle = forward(operation).subscribe({\n                                    next: observer.next.bind(observer),\n                                    error: observer.error.bind(observer),\n                                    complete: observer.complete.bind(observer)\n                                });\n                            })\n                            .catch(observer.error.bind(observer));\n\n                        return () => {\n                            if (handle) handle.unsubscribe();\n                        };\n                    })\n            ),\n            new HttpLink({\n                uri:\n                    (configMap.secureProtocol ? \"https://\" : \"http://\") +\n                    configMap.graphqlUrl,\n                headers: {\n                    Authorization:\n                        \"Bearer \" + localStorage.getItem(globalNames.authToken)\n                },\n                fetch\n            })\n        ]),\n        cache: cache\n    });\n\n    cache.writeData({\n        data: {\n            isLoggedIn: getUser() !== false\n        }\n    });\n\n    return (\n        <ApolloProvider client={client}>\n            <ApolloHooksProvider client={client}>\n                <Router hashType=\"hashbang\">\n                    <div>\n                        <Route path=\"/\" exact component={Index} />\n                        <Route path=\"/login\" component={LoadableLogin} />\n                        <PrivateRoute path=\"/me\" component={LoadableMe} />\n                    </div>\n                </Router>\n            </ApolloHooksProvider>\n        </ApolloProvider>\n    );\n}\n\nfunction SPA() {\n    return (\n        <UserProvider>\n            <SPAInner />\n        </UserProvider>\n    );\n}\n\nexport default SPA;\n","import jwtDecode from \"jwt-decode\";\n\nimport { globalNames } from \"./GetGlobals\";\n// eslint-disable-next-line no-unused-vars\nimport log from \"Log\";\n\nconst isTokenExpired = function() {\n    const token = localStorage.getItem(globalNames.authToken);\n    if (\n        token &&\n        parseInt(jwtDecode(token).exp) - 15 >\n            Math.round(new Date().getTime() / 1000)\n    ) {\n        return false;\n    }\n\n    return true;\n};\n\nconst getUser = function() {\n    const token = localStorage.getItem(globalNames.authToken);\n    if (token) {\n        const user = jwtDecode(token).data.user;\n        if (parseInt(user.uID) > 0) {\n            return user;\n        }\n    }\n    return false;\n};\n\nexport { getUser, isTokenExpired };\n","import React, { useState } from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport configMap, {globalNames} from \"Utils/GetGlobals\";\n\nconst UserContext = React.createContext([{}, () => {}]);\n\nconst UserProvider = props => {\n    const [user, setUser] = useState({});\n    if(!localStorage.getItem(globalNames.authToken)) {\n    localStorage.setItem(globalNames.authToken, configMap.anonymusToken);\n    }\n\n    return (\n        <UserContext.Provider value={[user, setUser]}>\n            {props.children}\n        </UserContext.Provider>\n    );\n};\n\nUserProvider.propTypes = {\n    children: PropTypes.object\n};\n\nexport { UserContext, UserProvider };\n"],"sourceRoot":""}
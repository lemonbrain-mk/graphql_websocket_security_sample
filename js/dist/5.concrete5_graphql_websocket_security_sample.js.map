{"version":3,"sources":["webpack:///./js/src/components/Login.jsx"],"names":["LOGIN_USER","gql","LoginForm","props","state","uName","uPassword","uMaintainLogin","redirectToReferrer","handleInputChange","bind","handleSignInSubmit","event","target","value","type","checked","name","setState","preventDefault","login","variables","username","password","location","from","pathname","React","Component","propTypes","PropTypes","func","object","Login","client","useApolloClient","useMutation","onCompleted","log","user","localStorage","setItem","constants","authToken","refreshToken","writeData","data","isLoggedIn","loading","error"],"mappings":"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","file":"5.concrete5_graphql_websocket_security_sample.js","sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport { Link, Redirect } from \"react-router-dom\";\nimport { useApolloClient, useMutation } from \"@apollo/react-hooks\";\nimport gql from \"graphql-tag\";\n\nimport Loading from \"./Loading\";\n\nimport { constants } from \"Utils/GetGlobals\";\nimport log from \"Log\";\n\nconst LOGIN_USER = gql`\n  mutation login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      authToken\n      refreshToken\n      user {\n        uID\n        uName\n        anonymus\n      }\n    }\n  }\n`;\n\nclass LoginForm extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      uName: \"\",\n      uPassword: \"\",\n      uMaintainLogin: false,\n      redirectToReferrer: false,\n    };\n\n    this.handleInputChange = this.handleInputChange.bind(this);\n    this.handleSignInSubmit = this.handleSignInSubmit.bind(this);\n  }\n\n  handleInputChange(event) {\n    const target = event.target;\n    const value = target.type === \"checkbox\" ? target.checked : target.value;\n    const name = target.name;\n\n    this.setState({\n      [name]: value\n    });\n  }\n\n  handleSignInSubmit(event) {\n    event.preventDefault();\n\n    this.props.login({\n      variables: {\n        username: this.state.uName,\n        password: this.state.uPassword\n      }\n    });\n  }\n\n  render() {\n    let { from } = this.props.location.state || { from: { pathname: \"/\" } };\n    let { redirectToReferrer } = this.state;\n\n    if (redirectToReferrer) return <Redirect to={from} />;\n\n    return (\n      <div className=\"authentication-type authentication-type-concrete active\">\n        <form onSubmit={this.handleSignInSubmit}>\n          <div className=\"form-group\">\n            <label className=\"control-label\" htmlFor=\"uName\">\n              Email Address\n            </label>\n            <input\n              name=\"uName\"\n              id=\"uName\"\n              className=\"form-control\"\n              autoFocus=\"autofocus\"\n              value={this.state.uName}\n              onChange={this.handleInputChange}\n            />\n          </div>\n\n          <div className=\"form-group\">\n            <label className=\"control-label\" htmlFor=\"uPassword\">\n              Password\n            </label>\n            <input\n              name=\"uPassword\"\n              id=\"uPassword\"\n              className=\"form-control\"\n              type=\"password\"\n              value={this.state.uPassword}\n              onChange={this.handleInputChange}\n            />\n          </div>\n\n          <div className=\"checkbox\">\n            <label>\n              <input\n                type=\"checkbox\"\n                name=\"uMaintainLogin\"\n                value=\"1\"\n                checked={this.state.uMaintainLogin}\n                onChange={this.handleInputChange}\n              />\n              Stay signed in for two weeks\n            </label>\n          </div>\n\n          <div className=\"form-group\">\n            <button className=\"btn btn-primary\">Log in</button>\n            <Link\n              to=\"/login/concrete/forgot_password\"\n              className=\"btn float-right\"\n            >\n              Forgot Password\n            </Link>\n          </div>\n        </form>\n      </div>\n    );\n  }\n}\n\nLoginForm.propTypes = {\n  login: PropTypes.func,\n  location: PropTypes.object,\n};\n\nexport default function Login() {\n  const client = useApolloClient();\n  const [login, { loading, error }] = useMutation(LOGIN_USER, {\n    onCompleted({ login }) {\n      log(login);\n      if (login && login.user) {\n        localStorage.setItem(constants.authToken, login.authToken);\n        localStorage.setItem(constants.refreshToken, login.refreshToken);\n        //set also current user and refreshToken\n        client.writeData({ data: { isLoggedIn: true } });\n        this.setState({ redirectToReferrer: true });\n      } else {\n        client.writeData({ data: { isLoggedIn: false } });\n      }\n    }\n  });\n  log(error);\n  if (loading) return <Loading />;\n  if (error) return <p>An error occurred</p>;\n\n  return <LoginForm login={login} />;\n}\n"],"sourceRoot":""}